---
export interface Props {
  delay?: number;
  direction?: 'up' | 'down' | 'left' | 'right';
  class?: string;
}

const { delay = 0, direction = 'up', class: className = '' } = Astro.props;
const delayMs = delay * 1000;
---

<div
  class={`spring-reveal spring-reveal--${direction} ${className}`}
  style={`--reveal-delay: ${delayMs}ms`}
  data-spring-reveal
>
  <slot />
</div>

<script>
  const reveals = document.querySelectorAll('[data-spring-reveal]');

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const el = entry.target as HTMLElement;
        const delay = parseInt(el.style.getPropertyValue('--reveal-delay') || '0');

        setTimeout(() => {
          el.classList.add('revealed');
        }, delay);

        observer.unobserve(el);
      }
    });
  }, {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  });

  reveals.forEach((el) => observer.observe(el));
</script>

<style>
  .spring-reveal {
    opacity: 0;
    will-change: transform, opacity;
    transition:
      transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
      opacity 0.6s ease-out;
  }

  .spring-reveal--up {
    transform: translateY(60px);
  }

  .spring-reveal--down {
    transform: translateY(-60px);
  }

  .spring-reveal--left {
    transform: translateX(60px);
  }

  .spring-reveal--right {
    transform: translateX(-60px);
  }

  .spring-reveal.revealed {
    opacity: 1;
    transform: translate(0, 0);
  }

  @media (prefers-reduced-motion: reduce) {
    .spring-reveal {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>
