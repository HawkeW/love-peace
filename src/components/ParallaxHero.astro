---
export interface Props {
  backgroundImage: string;
  title: string;
  subtitle?: string;
  date?: string;
}

const { backgroundImage, title, subtitle, date } = Astro.props;
---

<section class="parallax-hero">
  <div class="hero-background" style={`background-image: url('${backgroundImage}')`}></div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1 class="hero-title">{title}</h1>
    {subtitle && <p class="hero-subtitle">{subtitle}</p>}
    {date && <p class="hero-date">{date}</p>}
  </div>
  <slot />
</section>

<script>
  const hero = document.querySelector('.parallax-hero') as HTMLElement;
  const background = document.querySelector('.hero-background') as HTMLElement;
  const content = document.querySelector('.hero-content') as HTMLElement;

  if (hero && background && content) {
    let ticking = false;

    const updateParallax = () => {
      const scrollY = window.scrollY;
      const heroHeight = hero.offsetHeight;
      const scrollProgress = Math.min(scrollY / heroHeight, 1);

      // Background parallax (slower scroll) + Ken Burns zoom
      const bgTranslate = scrollY * 0.3;
      const kenBurnsScale = 1 + scrollProgress * 0.1;
      background.style.transform = `translateY(${bgTranslate}px) scale(${kenBurnsScale})`;

      // Content fade out on scroll
      content.style.opacity = String(1 - scrollProgress * 1.5);
      content.style.transform = `translateY(${scrollY * 0.5}px)`;

      ticking = false;
    };

    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(updateParallax);
        ticking = true;
      }
    }, { passive: true });

    // Ken Burns animation on load
    background.style.animation = 'kenBurns 20s ease-in-out infinite alternate';
  }
</script>

<style>
  .parallax-hero {
    position: relative;
    width: 100%;
    height: 100vh;
    min-height: 600px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .hero-background {
    position: absolute;
    inset: -10%;
    width: 120%;
    height: 120%;
    background-size: cover;
    background-position: center;
    will-change: transform;
    transform-origin: center center;
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      rgba(10, 10, 10, 0.3) 0%,
      rgba(10, 10, 10, 0.5) 50%,
      rgba(10, 10, 10, 0.8) 100%
    );
  }

  .hero-content {
    position: relative;
    z-index: 2;
    text-align: center;
    padding: 0 24px;
    will-change: transform, opacity;
  }

  .hero-title {
    font-family: 'Playfair Display', 'Noto Serif SC', 'Songti SC', Georgia, serif;
    font-size: clamp(2.5rem, 10vw, 5rem);
    font-weight: 400;
    letter-spacing: 0.15em;
    color: var(--text-primary, #fafafa);
    margin: 0 0 16px;
    text-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
  }

  .hero-subtitle {
    font-family: 'LXGW WenKai', 'Noto Sans SC', sans-serif;
    font-size: clamp(1rem, 3vw, 1.25rem);
    font-weight: 300;
    letter-spacing: 0.2em;
    color: var(--text-secondary, #a0a0a0);
    margin: 0 0 24px;
    text-shadow: 0 2px 15px rgba(0, 0, 0, 0.5);
  }

  .hero-date {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: clamp(1.25rem, 4vw, 1.75rem);
    font-weight: 400;
    letter-spacing: 0.3em;
    color: var(--gold, #c9a962);
    margin: 0;
    text-shadow: 0 2px 20px rgba(201, 169, 98, 0.3);
  }

  @keyframes kenBurns {
    0% {
      transform: scale(1) translate(0, 0);
    }
    100% {
      transform: scale(1.08) translate(-1%, -1%);
    }
  }

  @media (max-width: 768px) {
    .parallax-hero {
      min-height: 500px;
    }

    .hero-title {
      letter-spacing: 0.1em;
    }

    .hero-subtitle {
      letter-spacing: 0.1em;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-background {
      animation: none !important;
    }
  }
</style>
